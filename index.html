<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Atividade – Arrastar para Completar</title>
<style>
:root{
  --bg:#0f172a; --card:#111827; --muted:#1f2937; --text:#e5e7eb; --text-dim:#9ca3af;
  --primary:#22d3ee; --ok:#34d399; --err:#f87171; --warn:#f59e0b;
}
*{box-sizing:border-box}
html,body{height:100%; margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial;}
body{background: radial-gradient(1200px 800px at 80% -10%, #0ea5e910, transparent 60%),var(--bg); color:var(--text); display:flex; align-items:center; justify-content:center; padding:24px;}
.app{width:min(980px,100%)}
/* ...mantém todo CSS do seu index anterior... */
</style>
</head>
<body>
<div class="app">
<div class="card">
<header>
<h1>Analise a frase e complete as lacunas:</h1>
<div class="pill" id="progressPill">Pergunta 1/4</div>
</header>

<div class="input-group">
<input type="text" id="studentName" placeholder="Nome e Sobrenome">
<input type="text" id="studentID" placeholder="ID do estudante">
</div>

<div id="prompt" class="prompt" aria-live="polite"></div>
<div id="pool" class="pool" aria-label="Banco de palavras"></div>

<div class="toolbar">
<button class="primary" id="checkBtn">Conferir</button>
<button id="hintBtn">Dica</button>
<button id="resetBtn">Limpar</button>
<button id="shuffleBtn">Embaralhar</button>
<div class="stats">
<div class="stat" id="scoreStat">Pontuação: 0</div>
<div class="stat" id="accStat">Acertos: 0/0</div>
</div>
<button id="sendBtn">Enviar respostas</button>
</div>
<div class="nav">
<button id="prevBtn">◀️ Anterior</button>
<button id="nextBtn">Próxima ▶️</button>
</div>
<div id="feedback" class="feedback" aria-live="polite"></div>
</div>
</div>

<script>
// ====== CONFIG ======
const QUESTIONS = [
  {text:"Ao emitir uma mensagem para expressar seu [[propósito]], o emissor tem várias opções de [[escolha]], e ao mesmo tempo várias [[decisões]] a tomar. Para [[codificar]] a mensagem, por exemplo, ele pode escolher entre a língua portuguesa e a linguagem de sinais, e dentro desses códigos, escolher um ou outro elemento. Em relação ao [[conteúdo]], para falar de um determinado assunto, ele pode escolher entre uma ou outra informação ou [[evidência]]. O emissor pode, para além dessas escolhas, repetir uma parte da [[mensagem]], resumir tudo no final, ou simplesmente não [[expressar]] uma parte da mensagem, deixando para o [[receptor]] completar a informação, se ele assim desejar. São muitas decisões! E ao fazer essas escolhas e tomar essas decisões, o emissor acaba por construir e demonstrar um estilo de comunicação.", distractors:["elemento","assunto","informação"]},
  {text:"Na Teoria da Comunicação, o [[tratamento]] da mensagem diz respeito às decisões tomadas pelo emissor ao selecionar e [[estruturar]] os códigos e o conteúdo da comunicação. Um jornalista, por exemplo, quando escreve uma matéria para um [[jornal]], seleciona o conteúdo que ele entende ser interessante para os [[leitores]], escolhe as [[palavras]] (elementos do código) que acredita que o leitor vai entender, e estrutura suas [[afirmações]] (fatos, argumentos, referências) na forma que imagina que o leitor vai gostar de receber. Da mesma forma um [[publicitário]], quando vai preparar uma peça (um cartaz), se vê obrigado à selecionar o conteúdo que deve ser trabalhado, definir o código (texto, cores, ícones) que vai usar para transmitir a mensagem, e a forma de expressar a mensagem (uso de figuras de linguagem, variação no tamanho das letras, por exemplo).", distractors:["comunicação","mensagem","código"]},
  {text:"Entre as bases que influenciam as decisões do emissor no tratamento da mensagem está, em primeiro lugar, a [[personalidade]], as características individuais do emissor. Cada um de nós tem [[normas]] de codificação que nos são características, cada um vai estruturar os elementos da mensagem da forma como lhe fica melhor em [[juízo]]. Além disso, nossas [[habilidades]] de comunicação, nossas [[atitudes]], nossos conhecimentos, nossa cultura e nossa posição [[social]] também vão ditar algumas decisões. É por isso que as vezes, diante de um texto, um cartaz, uma peça [[publicitária]], concluímos que “tal [[estilo]] nos remete à tal [[pessoa]]”, porque conseguimos identificar o [[emissor]] por meio da mensagem que ele cria, por conta do seu estilo.", distractors:["tratamento","mensagem","características"]},
  {text:"Mas outro fator de extrema importância nas tomadas de decisão com relação ao tratamento da mensagem é o [[receptor]]. Todo [[emissor]] com um propósito de comunicar transmite uma mensagem esperando uma [[resposta]] do receptor, que ele aceite ou faça algo. Como emissores precisamos nos ater a [[presença]] constante do receptor, escolhendo [[códigos]] que ele entenda, selecionando elementos que vão chamar a sua [[atenção]], que lhe sejam fáceis de [[decodificar]], conteúdos que lhe sejam interessantes e [[relevantes]], e estruturamos a mensagem buscando [[reduzir]] ao máximo o esforço para decodificar e interpretar a mensagem. Tudo isso porque temos um propósito à comunicar, e esperamos que o receptor responda à mensagem de forma [[correspondente]]!!", distractors:["importância","decisões","mensagem"]}
];
const POINTS_PER_QUESTION = 0.5;
const STORAGE_KEY="dragfill_progress_v1";
let state={index:0,score:0,attempts:0,correctCount:0,totalBlanks:0,placed:{}};
const qs=(s,e=document)=>e.querySelector(s);
const qsa=(s,e=document)=>[...e.querySelectorAll(s)];
const shuffle=arr=>arr.map(v=>[Math.random(),v]).sort((a,b)=>a[0]-b[0]).map(x=>x[1]);
function save(){localStorage.setItem(STORAGE_KEY,JSON.stringify({index:state.index,score:state.score}));}
function load(){const raw=localStorage.getItem(STORAGE_KEY);if(!raw) return; try{const d=JSON.parse(raw);if(typeof d.index==='number') state.index=Math.min(Math.max(0,d.index),QUESTIONS.length-1); if(typeof d.score==='number') state.score=d.score;}catch{}}

// ====== PARSE ======
function parseQuestion(text){const parts=[];const answers=[];let i=0;while(i<text.length){const s=text.indexOf("[[",i);if(s===-1){parts.push(text.slice(i));break;}const e=text.indexOf("]]",s+2);if(e===-1){parts.push(text.slice(i));break;}if(s>i) parts.push(text.slice(i,s));const ans=text.slice(s+2,e).trim();answers.push(ans);parts.push({answer:ans});i=e+2;}return {parts,answers};}

// ====== RENDER ======
// ...manter código de render, placeToken, updateAccuracy, etc, igual ao seu index anterior...

// ====== ENVIAR PARA PLANILHA ======
qs('#sendBtn').addEventListener('click',async()=>{
  const name=qs('#studentName').value.trim();
  const id=qs('#studentID').value.trim();
  if(!name||!id){feedbackEl.textContent='Preencha Nome e ID antes de enviar!'; feedbackEl.className='feedback error'; return;}
  
  const data={
    nome:name,
    id:id,
    q1:state.placed['b0']||'',
    q2:state.placed['b1']||'',
    q3:state.placed['b2']||'',
    q4:state.placed['b3']||'',
    score:state.score,
    acertos:state.correctCount
  };
  
  try{
    const resp = await fetch('https://script.google.com/macros/s/AKfycbyQldraslnKNE4R5Qh5Y8DItOIK9SUYgC3MHKrVhnKuSC_saG7IfkHfmnyQRrOcXghr/exec',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify(data)
    });
    if(resp.ok){
      feedbackEl.textContent='Enviado com sucesso! ✅';
      feedbackEl.className='feedback success';
    } else {
      feedbackEl.textContent='Falha ao enviar!';
      feedbackEl.className='feedback error';
    }
  }catch(err){
    feedbackEl.textContent='Falha ao enviar!';
    feedbackEl.className='feedback error';
    console.error(err);
  }
});

// ====== INIT ======
load(); render();
</script>
</body>
</html>